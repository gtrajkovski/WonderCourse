---
phase: 06-textbook-generation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/generators/schemas/textbook.py
  - tests/test_textbook_schemas.py
autonomous: true

must_haves:
  truths:
    - "TextbookOutlineSchema validates outline with 5-8 section entries"
    - "TextbookSectionSchema validates section with heading, content, and key_concepts"
    - "TextbookChapterSchema validates full chapter with introduction, sections, conclusion, references, glossary, and image placeholders"
    - "GlossaryTerm and ImagePlaceholder models validate structured sub-components"
    - "Reference model is reused from reading.py for APA 7 citations"
  artifacts:
    - path: "src/generators/schemas/textbook.py"
      provides: "All Pydantic schemas for textbook generation pipeline"
      exports: ["TextbookOutlineSchema", "SectionOutline", "TextbookSectionSchema", "TextbookChapterSchema", "GlossaryTerm", "ImagePlaceholder"]
    - path: "tests/test_textbook_schemas.py"
      provides: "Schema validation tests"
      min_lines: 50
  key_links:
    - from: "src/generators/schemas/textbook.py"
      to: "src/generators/schemas/reading.py"
      via: "import Reference"
      pattern: "from src\\.generators\\.schemas\\.reading import Reference"
---

<objective>
Create all Pydantic v2 schemas needed for the textbook generation pipeline: outline schema (for hierarchical expansion step 1), section schema (for per-section generation), glossary term and image placeholder sub-models, and the final assembled chapter schema.

Purpose: These schemas are the foundation for all textbook generation. The TextbookGenerator, post-processing utilities, and API layer all depend on these types.
Output: `src/generators/schemas/textbook.py` with all schema classes, plus validation tests.
</objective>

<execution_context>
@C:\Users\gpt30\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\gpt30\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/generators/schemas/reading.py
@src/generators/base_generator.py
@src/core/models.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create textbook Pydantic schemas</name>
  <files>src/generators/schemas/textbook.py</files>
  <action>
Create `src/generators/schemas/textbook.py` with these Pydantic v2 models:

1. **SectionOutline(BaseModel):**
   - `title: str` - Section heading
   - `description: str` - 1-2 sentence overview of section content
   - `estimated_words: int` - Target word count (400-600)

2. **TextbookOutlineSchema(BaseModel):**
   - `chapter_title: str` - Chapter title aligned to learning outcome
   - `introduction_summary: str` - What the introduction will cover
   - `sections: List[SectionOutline]` - min_length=5, max_length=8, main content sections
   - `conclusion_summary: str` - What the conclusion will summarize
   - `estimated_total_words: int` - Sum of all section estimates

3. **TextbookSectionSchema(BaseModel):**
   - `heading: str` - Section heading from outline
   - `content: str` - Section body text (400-600 words)
   - `key_concepts: List[str]` - Main concepts covered in this section (2-5 items)

4. **GlossaryTerm(BaseModel):**
   - `term: str` - The term or concept
   - `definition: str` - Clear, concise definition (1-2 sentences)
   - `context: str` - Example usage from the chapter

5. **ImagePlaceholder(BaseModel):**
   - `figure_number: str` - Figure number (e.g., "Figure 6.1")
   - `caption: str` - 1-2 sentence caption describing the figure
   - `alt_text: str` - Accessibility description for screen readers
   - `suggested_type: str` - Type: diagram, chart, photo, screenshot, illustration
   - `placement_after: str` - Place after this paragraph (first 20 chars of anchor text)

6. **TextbookChapterSchema(BaseModel):**
   - `chapter_number: int` - Chapter number in sequence
   - `title: str` - Chapter title
   - `introduction: str` - Opening section (100-150 words)
   - `sections: List[TextbookSectionSchema]` - min_length=5, max_length=8
   - `conclusion: str` - Closing summary (100-150 words)
   - `references: List[Reference]` - Reuse from reading.py, min_length=3, max_length=10
   - `glossary_terms: List[GlossaryTerm]` - min_length=5, max_length=20
   - `image_placeholders: List[ImagePlaceholder]` - min_length=2, max_length=8
   - `learning_outcome_id: str` - The learning outcome this chapter addresses

Import `Reference` from `src.generators.schemas.reading` to reuse the APA 7 citation model.
Use Field() with description strings on every field for Claude structured output compatibility.
Follow the exact same pattern as existing schemas (reading.py, quiz.py, etc.).
  </action>
  <verify>
Run: `python -c "from src.generators.schemas.textbook import TextbookOutlineSchema, TextbookSectionSchema, TextbookChapterSchema, GlossaryTerm, ImagePlaceholder, SectionOutline; print('All schemas importable')"` succeeds.
Run: `python -c "from src.generators.schemas.textbook import TextbookChapterSchema; print(TextbookChapterSchema.model_json_schema())"` produces valid JSON schema with all fields.
  </verify>
  <done>All 6 Pydantic schema classes exist in textbook.py, are importable, produce valid JSON schemas, and Reference is reused from reading.py.</done>
</task>

<task type="auto">
  <name>Task 2: Write schema validation tests</name>
  <files>tests/test_textbook_schemas.py</files>
  <action>
Create `tests/test_textbook_schemas.py` with tests following the existing test patterns:

1. **test_outline_schema_validates** - Create valid TextbookOutlineSchema instance, verify field values and section count constraints (5-8).
2. **test_section_schema_validates** - Create valid TextbookSectionSchema instance with heading, content, key_concepts.
3. **test_chapter_schema_validates** - Create valid TextbookChapterSchema with all sub-components (sections, glossary, images, references).
4. **test_chapter_schema_reuses_reference** - Verify that TextbookChapterSchema.references uses the same Reference model from reading.py.
5. **test_glossary_term_validates** - Create valid GlossaryTerm with term, definition, context.
6. **test_image_placeholder_validates** - Create valid ImagePlaceholder with all fields.
7. **test_chapter_schema_produces_json_schema** - Call model_json_schema() and verify it contains expected keys.
8. **test_outline_min_sections_enforced** - Verify that fewer than 5 sections raises ValidationError.

Use `pytest.raises(ValidationError)` from pydantic for constraint tests.
  </action>
  <verify>Run: `python -m pytest tests/test_textbook_schemas.py -v` passes all 8 tests.</verify>
  <done>8 schema tests passing, covering all textbook Pydantic models including constraint validation.</done>
</task>

</tasks>

<verification>
- All 6 schema classes importable from `src.generators.schemas.textbook`
- `TextbookChapterSchema.model_json_schema()` produces valid JSON schema
- Reference model reused from reading.py (not duplicated)
- All 8 tests pass
- Existing tests still pass: `python -m pytest` (300+ tests)
</verification>

<success_criteria>
- Textbook schemas defined with proper Pydantic v2 Field annotations
- All constraints (min_length, max_length) enforced at schema level
- Reference model shared with ReadingSchema (single source of truth)
- Tests verify both valid construction and constraint enforcement
</success_criteria>

<output>
After completion, create `.planning/phases/06-textbook-generation/06-01-SUMMARY.md`
</output>
