---
phase: 01-foundation-infrastructure
plan: 02
type: tdd
wave: 1
depends_on: []
files_modified:
  - src/core/models.py
  - tests/test_models.py
autonomous: true

must_haves:
  truths:
    - "Course dataclass round-trips through to_dict/from_dict without data loss"
    - "Module, Lesson, Activity nested objects serialize recursively"
    - "LearningOutcome stores Bloom's level, audience, behavior, condition, degree, tags"
    - "Enums (ContentType, ActivityType, BuildState, BloomLevel, WWHAAPhase) serialize as strings and deserialize back"
    - "from_dict ignores unknown fields for schema evolution tolerance"
    - "Default IDs are generated with uuid4 hex prefix pattern"
  artifacts:
    - path: "src/core/models.py"
      provides: "Course, Module, Lesson, Activity, LearningOutcome, TextbookChapter dataclasses and all enums"
      contains: "class Course"
      min_lines: 200
    - path: "tests/test_models.py"
      provides: "Serialization round-trip tests for all dataclasses"
      contains: "test_course_round_trip"
      min_lines: 100
  key_links:
    - from: "src/core/models.py"
      to: "Course.modules -> Module.lessons -> Lesson.activities"
      via: "Nested dataclass lists with recursive to_dict/from_dict"
      pattern: "\\[.*\\.to_dict\\(\\) for .* in self\\."
---

<objective>
Create all core data models for Course Builder Studio using Python dataclasses with complete serialization support.

Purpose: Every feature in the system depends on these models -- ProjectStore persists them, AI client generates content for them, Flask routes expose them. This is the data foundation.
Output: src/core/models.py with 6 dataclasses and 5 enums, tests/test_models.py with round-trip tests
</objective>

<execution_context>
@C:\Users\gpt30\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\gpt30\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Reference pattern from ScreenCast Studio:
@C:\ScreencastHelper\src\core\models.py
</context>

<feature>
  <name>Core Data Models with Serialization</name>
  <files>src/core/models.py, tests/test_models.py</files>
  <behavior>
    All dataclasses must support to_dict() -> dict and from_dict(dict) -> instance round-trips.

    **Enums (5):**
    - ContentType: VIDEO, READING, QUIZ, HOL, COACH, LAB, DISCUSSION, ASSIGNMENT, PROJECT, RUBRIC
    - ActivityType: GRADED_QUIZ, PRACTICE_QUIZ, UNGRADED_LAB, PEER_REVIEW, DISCUSSION_PROMPT, HANDS_ON_LAB, COACH_DIALOGUE, VIDEO_LECTURE, READING_MATERIAL, ASSIGNMENT_SUBMISSION, PROJECT_MILESTONE
    - BuildState: DRAFT, GENERATING, GENERATED, REVIEWED, APPROVED, PUBLISHED
    - BloomLevel: REMEMBER, UNDERSTAND, APPLY, ANALYZE, EVALUATE, CREATE
    - WWHAAPhase: HOOK, OBJECTIVE, CONTENT, IVQ, SUMMARY, CTA

    **Dataclasses (6):**

    1. `Activity` - Atomic content unit:
       - id: str (default: f"act_{uuid4.hex[:8]}")
       - title: str = ""
       - content_type: ContentType = ContentType.VIDEO
       - activity_type: ActivityType = ActivityType.VIDEO_LECTURE
       - wwhaa_phase: WWHAAPhase = WWHAAPhase.CONTENT
       - content: str = "" (generated content body)
       - build_state: BuildState = BuildState.DRAFT
       - word_count: int = 0
       - estimated_duration_minutes: float = 0.0
       - bloom_level: Optional[BloomLevel] = None
       - order: int = 0
       - metadata: Dict[str, Any] = field(default_factory=dict)
       - created_at: str (ISO timestamp)
       - updated_at: str (ISO timestamp)

    2. `Lesson` - Contains activities:
       - id: str (default: f"les_{uuid4.hex[:8]}")
       - title: str = ""
       - description: str = ""
       - activities: List[Activity] = []
       - order: int = 0
       - created_at/updated_at: str (ISO timestamp)

    3. `Module` - Contains lessons:
       - id: str (default: f"mod_{uuid4.hex[:8]}")
       - title: str = ""
       - description: str = ""
       - lessons: List[Lesson] = []
       - order: int = 0
       - created_at/updated_at: str (ISO timestamp)

    4. `LearningOutcome`:
       - id: str (default: f"lo_{uuid4.hex[:8]}")
       - audience: str = "" (e.g., "data analysts")
       - behavior: str = "" (e.g., "implement a decision tree classifier")
       - condition: str = "" (e.g., "given a labeled dataset")
       - degree: str = "" (e.g., "with 80%+ accuracy")
       - bloom_level: BloomLevel = BloomLevel.APPLY
       - tags: List[str] = []
       - mapped_activity_ids: List[str] = [] (activity IDs this outcome maps to)

    5. `TextbookChapter`:
       - id: str (default: f"ch_{uuid4.hex[:8]}")
       - title: str = ""
       - sections: List[Dict[str, str]] = [] (each dict has "heading" and "body")
       - glossary_terms: List[Dict[str, str]] = [] (each dict has "term" and "definition")
       - word_count: int = 0
       - learning_outcome_id: Optional[str] = None
       - created_at/updated_at: str (ISO timestamp)

    6. `Course` - Root container:
       - id: str (default: f"course_{uuid4.hex[:12]}")
       - title: str = "Untitled Course"
       - description: str = ""
       - audience_level: str = "intermediate"
       - target_duration_minutes: int = 60
       - modality: str = "online" (online, blended, in-person)
       - modules: List[Module] = []
       - learning_outcomes: List[LearningOutcome] = []
       - textbook_chapters: List[TextbookChapter] = []
       - schema_version: int = 1
       - created_at/updated_at: str (ISO timestamp)

    **Serialization patterns (copy from ScreenCast Studio):**
    - to_dict: Enum.value for enums, [item.to_dict() for item in list] for nested objects
    - from_dict: dict(data) defensive copy, pop nested lists, filter to known fields, reconstruct nested objects
    - Schema evolution: from_dict ignores unknown keys using __dataclass_fields__ filter

    **Test cases (RED phase):**
    - test_content_type_enum_values: all 10 values exist
    - test_build_state_enum_values: all 6 values exist
    - test_bloom_level_enum_values: all 6 values exist
    - test_activity_round_trip: create Activity, to_dict, from_dict, assert all fields match
    - test_lesson_round_trip: Lesson with 2 activities
    - test_module_round_trip: Module with 2 lessons each having activities
    - test_learning_outcome_round_trip: with bloom_level and tags
    - test_textbook_chapter_round_trip: with sections and glossary_terms
    - test_course_round_trip: full Course with modules, learning_outcomes, textbook_chapters
    - test_from_dict_ignores_unknown_fields: add extra key, no error
    - test_from_dict_handles_missing_optional: partial dict works
    - test_enum_string_deserialization: BuildState("draft") works in from_dict
    - test_default_id_generation: IDs have correct prefix pattern
    - test_default_timestamps: created_at and updated_at are ISO format
  </behavior>
  <implementation>
    Follow ScreenCast Studio's models.py pattern exactly. Key implementation details:
    - Use @dataclass decorator with field(default_factory=...) for mutable defaults
    - ID generation: field(default_factory=lambda: f"course_{uuid.uuid4().hex[:12]}")
    - Timestamp: field(default_factory=lambda: datetime.now().isoformat())
    - Enum handling in from_dict: try/except ValueError with fallback to first enum value
    - Known field filter: `known = {f.name for f in cls.__dataclass_fields__.values()}`
  </implementation>
</feature>

<verification>
1. `py -3 -m pytest tests/test_models.py -v` -- all tests pass
2. `py -3 -c "from src.core.models import Course, Module, Lesson, Activity; c = Course(); print(c.to_dict())"` works
3. Round-trip fidelity: Course with nested modules/lessons/activities survives to_dict -> from_dict
</verification>

<success_criteria>
- All 5 enums defined with correct values
- All 6 dataclasses have to_dict/from_dict methods
- Nested serialization works (Course -> Modules -> Lessons -> Activities)
- from_dict ignores unknown fields (schema evolution)
- Default IDs use correct prefix patterns
- All round-trip tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-infrastructure/01-02-SUMMARY.md`
</output>
