---
phase: 05-extended-content-generation
plan: 09
type: execute
wave: 3
depends_on: ["05-02", "05-03", "05-04", "05-05", "05-06", "05-07", "05-08"]
files_modified:
  - src/api/content.py
  - tests/test_content_api.py
autonomous: true

must_haves:
  truths:
    - "Content API dispatches to all 7 new generators based on ContentType enum"
    - "Generate endpoint works for HOL, COACH, LAB, DISCUSSION, ASSIGNMENT, PROJECT content types"
    - "Regenerate endpoint works for all 7 new content types"
    - "Practice quiz dispatches via ActivityType.PRACTICE_QUIZ distinction (ContentType.QUIZ + ActivityType check)"
    - "Existing VIDEO, READING, QUIZ, RUBRIC dispatch still works (no regressions)"
  artifacts:
    - path: "src/api/content.py"
      provides: "Updated dispatch for all 11 content types"
      contains: "HOLGenerator"
    - path: "tests/test_content_api.py"
      provides: "Integration tests for new content type dispatch"
      contains: "test_generate_hol"
  key_links:
    - from: "src/api/content.py"
      to: "src/generators/hol_generator.py"
      via: "import and dispatch"
      pattern: "HOLGenerator\\(\\)"
    - from: "src/api/content.py"
      to: "src/generators/coach_generator.py"
      via: "import and dispatch"
      pattern: "CoachGenerator\\(\\)"
    - from: "src/api/content.py"
      to: "src/generators/practice_quiz_generator.py"
      via: "import and dispatch"
      pattern: "PracticeQuizGenerator\\(\\)"
---

<objective>
Wire all 7 new generators into the content API dispatch map and add integration tests for each new content type.

Purpose: Complete the content generation pipeline so all 11 content types are accessible via the existing generate/regenerate API endpoints.
Output: Updated content.py with dispatch for all types + integration tests
</objective>

<execution_context>
@C:\Users\gpt30\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\gpt30\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@src/api/content.py
@tests/test_content_api.py
@src/core/models.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add 7 new content types to content.py dispatch</name>
  <files>src/api/content.py</files>
  <action>
Update `src/api/content.py` to dispatch to all 7 new generators. Add imports at the top of the file:

```python
from src.generators.hol_generator import HOLGenerator
from src.generators.coach_generator import CoachGenerator
from src.generators.practice_quiz_generator import PracticeQuizGenerator
from src.generators.lab_generator import LabGenerator
from src.generators.discussion_generator import DiscussionGenerator
from src.generators.assignment_generator import AssignmentGenerator
from src.generators.project_generator import ProjectMilestoneGenerator
```

In the `generate_content()` function, rewrite the full dispatch chain. The CRITICAL ordering is that the practice quiz check (QUIZ + PRACTICE_QUIZ activity_type) must come BEFORE the generic QUIZ check. Here is the complete dispatch order:

```python
if content_type == ContentType.VIDEO:
    generator = VideoScriptGenerator()
    from src.generators.schemas.video_script import VideoScriptSchema
    schema = VideoScriptSchema
elif content_type == ContentType.READING:
    generator = ReadingGenerator()
    from src.generators.schemas.reading import ReadingSchema
    schema = ReadingSchema
elif content_type == ContentType.QUIZ and activity.activity_type == ActivityType.PRACTICE_QUIZ:
    generator = PracticeQuizGenerator()
    from src.generators.schemas.practice_quiz import PracticeQuizSchema
    schema = PracticeQuizSchema
elif content_type == ContentType.QUIZ:
    generator = QuizGenerator()
    from src.generators.schemas.quiz import QuizSchema
    schema = QuizSchema
elif content_type == ContentType.RUBRIC:
    generator = RubricGenerator()
    from src.generators.schemas.rubric import RubricSchema
    schema = RubricSchema
elif content_type == ContentType.HOL:
    generator = HOLGenerator()
    from src.generators.schemas.hol import HOLSchema
    schema = HOLSchema
elif content_type == ContentType.COACH:
    generator = CoachGenerator()
    from src.generators.schemas.coach import CoachSchema
    schema = CoachSchema
elif content_type == ContentType.LAB:
    generator = LabGenerator()
    from src.generators.schemas.lab import LabSchema
    schema = LabSchema
elif content_type == ContentType.DISCUSSION:
    generator = DiscussionGenerator()
    from src.generators.schemas.discussion import DiscussionSchema
    schema = DiscussionSchema
elif content_type == ContentType.ASSIGNMENT:
    generator = AssignmentGenerator()
    from src.generators.schemas.assignment import AssignmentSchema
    schema = AssignmentSchema
elif content_type == ContentType.PROJECT:
    generator = ProjectMilestoneGenerator()
    from src.generators.schemas.project import ProjectMilestoneSchema
    schema = ProjectMilestoneSchema
else:
    return jsonify({"error": f"Unsupported content type: {content_type.value}"}), 400
```

Note: Practice quiz (QUIZ + PRACTICE_QUIZ) MUST come before generic QUIZ in the elif chain.

Also add `from src.core.models import ContentType, BuildState, ActivityType` (add ActivityType to existing import).

Apply the SAME changes to the `regenerate_content()` function's dispatch block (it has an identical if/elif chain that needs the same additions).

Update the module docstring to reflect 11 content types instead of 4.
  </action>
  <verify>
```bash
python -c "from src.api.content import content_bp; print('Content API imports OK')"
```
  </verify>
  <done>Content API dispatches to all 11 content types (4 existing + 7 new). Practice quizzes distinguished from graded quizzes via ActivityType check.</done>
</task>

<task type="auto">
  <name>Task 2: Add integration tests for new content type dispatch</name>
  <files>tests/test_content_api.py</files>
  <action>
Add integration tests to `tests/test_content_api.py` for each new content type. Follow the existing test pattern in the file. For each new type, add a test that:
1. Creates a course with an activity of the appropriate content_type
2. Mocks the generator's generate() method to return a sample schema instance and metadata dict
3. Calls POST /api/courses/{id}/activities/{aid}/generate
4. Asserts 200 response with content and metadata

Add these tests (7 total, one per new content type):
- `test_generate_hol_content` - ContentType.HOL, mock HOLGenerator
- `test_generate_coach_content` - ContentType.COACH, mock CoachGenerator
- `test_generate_practice_quiz_content` - ContentType.QUIZ + ActivityType.PRACTICE_QUIZ, mock PracticeQuizGenerator
- `test_generate_lab_content` - ContentType.LAB, mock LabGenerator
- `test_generate_discussion_content` - ContentType.DISCUSSION, mock DiscussionGenerator
- `test_generate_assignment_content` - ContentType.ASSIGNMENT, mock AssignmentGenerator
- `test_generate_project_content` - ContentType.PROJECT, mock ProjectMilestoneGenerator

For each test, mock the specific generator class in `src.api.content` module. Use `mocker.patch('src.api.content.HOLGenerator')` pattern. The mock's generate() should return a MagicMock with model_dump() and model_dump_json() methods.

Also add a test verifying that practice quiz dispatches to PracticeQuizGenerator (not QuizGenerator) when activity_type is PRACTICE_QUIZ.

Run all existing tests to ensure no regressions.
  </action>
  <verify>
```bash
pytest tests/test_content_api.py -v
pytest tests/ -x -q
```
  </verify>
  <done>All content API tests pass including 7 new dispatch tests. Existing tests show no regressions. All 250+ tests pass.</done>
</task>

</tasks>

<verification>
1. `pytest tests/test_content_api.py -v` -- all tests pass (existing + 7-8 new)
2. `pytest tests/ -x -q` -- all tests pass (no regressions)
3. Content API module imports without errors
4. All 11 content types have dispatch entries in both generate and regenerate functions
</verification>

<success_criteria>
- Content API dispatches to all 11 content types
- Practice quiz correctly distinguished from graded quiz
- All existing tests pass (no regressions)
- New integration tests verify each new dispatch path
</success_criteria>

<output>
After completion, create `.planning/phases/05-extended-content-generation/05-09-SUMMARY.md`
</output>
