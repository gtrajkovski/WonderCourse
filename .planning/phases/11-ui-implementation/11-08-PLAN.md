---
phase: 11-ui-implementation
plan: 08
type: execute
wave: 4
depends_on: ["11-03"]
files_modified:
  - templates/publish.html
  - static/css/pages/publish.css
  - static/js/pages/publish.js
  - app.py
autonomous: true

must_haves:
  truths:
    - "User can view publish page at /courses/{id}/publish"
    - "User can see validation status before export"
    - "User can select export format and download"
    - "User can preview export contents before download"
    - "Validation errors block export without force option"
  artifacts:
    - path: "templates/publish.html"
      provides: "Export and publish interface"
      contains: "export-options"
    - path: "static/js/pages/publish.js"
      provides: "Publish page controller"
      contains: "handleExport"
  key_links:
    - from: "static/js/pages/publish.js"
      to: "/api/courses/{id}/export"
      via: "fetch API"
      pattern: "api.*export"
    - from: "static/js/pages/publish.js"
      to: "/api/courses/{id}/validate"
      via: "fetch API"
      pattern: "api.*validate"
---

<objective>
Create the Publish page for course validation, export format selection, and package download.

Purpose: The Publish page is the final step where users validate their course, select export formats, and download packages for use in LMS or as instructor materials.

Output: Publish template with validation summary, export format cards, preview capability, and download functionality.
</objective>

<execution_context>
@C:\Users\gpt30\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\gpt30\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/11-ui-implementation/11-CONTEXT.md
@.planning/phases/11-ui-implementation/11-03-SUMMARY.md
@src/api/validation.py
@src/api/export.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Publish Page Template</name>
  <files>
    templates/publish.html
    static/css/pages/publish.css
    app.py
  </files>
  <action>
Create Publish page layout:

**templates/publish.html:**
Extend base.html with course context.

Two-section layout:

**Section 1: Validation Status**
Card showing course readiness:
- Header: "Course Validation" + Refresh button
- Overall status: Ready to Publish / Has Issues / Not Ready
- Progress summary: X/Y activities approved, Z warnings, W errors
- Expandable sections for each validator:
  - Course Structure (module count, duration)
  - Learning Outcomes (coverage, alignment)
  - Bloom's Taxonomy (distribution)
  - Quiz Quality (distractor analysis)
- Each section shows: status icon, count of issues, expandable details
- Errors shown in red, warnings in yellow, suggestions in blue
- "Run Validation" button to refresh

**Section 2: Export Options**
Grid of export format cards:

Card 1: Instructor Package (ZIP)
- Icon, title, description
- Contents preview: syllabus, lesson plans, rubrics, quizzes
- "Preview" and "Download" buttons

Card 2: LMS Manifest (JSON)
- For LMS import
- Shows course hierarchy structure
- "Preview" and "Download" buttons

Card 3: Textbook (DOCX)
- For student/instructor reference
- Word document format
- "Preview" and "Download" buttons

Card 4: SCORM Package (ZIP)
- LMS-compliant package
- SCORM 1.2 format
- "Preview" and "Download" buttons

Each card shows:
- Status: Available / Requires Validation / Missing Content
- File size estimate (if available)
- Last exported date (if previously exported)

**Validation Gate:**
If validation has errors:
- Show warning banner
- Disable download buttons (or show "Force Export" option)
- Explain what needs to be fixed

**static/css/pages/publish.css:**
- .publish-container: main layout
- .validation-section: validation card
- .validation-header: status badge and refresh
- .validation-summary: counts and progress
- .validator-group: expandable section
- .validator-item: individual issue
- .issue-error, .issue-warning, .issue-suggestion
- .export-grid: grid of export cards
- .export-card: individual format card
- .export-card.disabled: blocked by validation
- .export-actions: preview/download buttons
- .force-export: danger button styling

**app.py:**
Add route:
```python
@app.route('/courses/<course_id>/publish')
@login_required
def publish(course_id):
    course = project_store.load(course_id)
    if not course:
        return redirect(url_for('dashboard'))
    return render_template('publish.html',
                         course=course,
                         active_page='publish',
                         breadcrumb=[...])
```
  </action>
  <verify>
Visit /courses/{id}/publish:
- Validation section shows course status
- Export cards display for each format
- Buttons show appropriate enabled/disabled state
  </verify>
  <done>
Publish template created with validation summary and export format cards. Route added.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Validation Display</name>
  <files>
    static/js/pages/publish.js
    templates/publish.html
  </files>
  <action>
Add JavaScript for validation:

**static/js/pages/publish.js:**

PublishController class:

**Initialization:**
- validationSection: element reference
- exportCards: element references
- validationData: cached validation results
- isPublishable: boolean flag

**Validation:**
- loadValidation():
  - GET /api/courses/{id}/validate
  - Store results in validationData
  - Set isPublishable flag
  - Render validation UI
  - Enable/disable export buttons

- renderValidation(data):
  - Overall status badge (green/yellow/red)
  - Summary counts: errors, warnings, suggestions
  - For each validator in data:
    - Create expandable section
    - Show validator name and status
    - List issues with severity styling

- renderValidatorSection(name, result):
  - Header with expand/collapse toggle
  - Status icon (check/warning/error)
  - Issue list (errors first, then warnings, then suggestions)
  - Metrics if available (coverage percentage, etc.)

- handleRefreshValidation():
  - Show loading state
  - Call loadValidation()
  - Toast "Validation refreshed"

**Publishability Check:**
- checkPublishable():
  - GET /api/courses/{id}/publishable
  - Returns {is_publishable: bool, blockers: [...]}
  - Update UI based on result

**Expand/Collapse:**
- toggleValidator(name):
  - Toggle 'expanded' class on section
  - Animate open/close

**Update templates/publish.html:**
- Include publish.js
- Validation section structure with placeholders
- Wire refresh button
- Initialize PublishController on load
  </action>
  <verify>
On publish page:
- Validation loads and displays automatically
- Overall status shows correctly (green if ready)
- Validator sections expand/collapse
- Issues displayed with correct severity styling
- Refresh button reloads validation
  </verify>
  <done>
Validation display works. Shows all validators with expandable sections. Status indicators accurate.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add Export Preview and Download</name>
  <files>
    static/js/pages/publish.js
    templates/publish.html
  </files>
  <action>
Add export functionality:

**Add to static/js/pages/publish.js:**

**Preview:**
- handlePreview(format):
  - GET /api/courses/{id}/export/preview?format={format}
  - Open modal showing preview data:
    - File list for ZIP formats
    - JSON preview for manifest
    - Content preview for DOCX
  - Show validation status in preview
  - Close button

- renderPreviewModal(format, data):
  - Modal title: "{Format} Export Preview"
  - File list or content preview
  - Validation warnings if any
  - "Download" and "Cancel" buttons

**Download:**
- handleDownload(format, force=false):
  - If not isPublishable and not force:
    - Show confirmation modal
    - "Export anyway?" with warning
    - If confirmed, call with force=true
  - Else:
    - Build URL: /api/courses/{id}/export/{format}?force={force}
    - Trigger download (create hidden anchor and click)
    - Toast "Download started"

- triggerDownload(url, filename):
  - Create anchor element
  - Set href and download attribute
  - Append to body, click, remove

**Export Cards:**
- initExportCards():
  - For each card, check if enabled
  - If validation fails, show disabled state
  - Bind preview and download buttons

- updateExportCardState(format, enabled, message):
  - Add/remove .disabled class
  - Update status message
  - Enable/disable buttons

**Force Export:**
- showForceExportWarning(format):
  - Modal explaining validation failed
  - List blockers
  - "Export Anyway" danger button
  - "Cancel" button

**Update templates/publish.html:**
- Export card button onclick handlers
- Preview modal markup
- Force export confirmation modal
- Include format in data attributes
  </action>
  <verify>
On publish page:
- Click Preview -> modal shows export contents
- Click Download -> file downloads (if validation passes)
- If validation fails -> confirmation modal appears
- Force export downloads with warning acknowledged
- Download triggers browser save dialog
  </verify>
  <done>
Export preview and download work. Validation gate blocks downloads. Force export available with warning.
  </done>
</task>

</tasks>

<verification>
- Publish page loads at /courses/{id}/publish
- Validation runs and displays automatically
- All four export formats show as cards
- Preview shows export contents in modal
- Download triggers file save
- Validation errors block download (without force)
- Force export works with warning
- No JavaScript console errors
</verification>

<success_criteria>
1. Validation section shows overall status
2. Expandable validator sections with issue details
3. Four export format cards with icons and descriptions
4. Preview modal shows export contents
5. Download triggers browser save dialog
6. Validation gate prevents download if errors exist
7. Force export available with warning confirmation
8. Refresh button updates validation
</success_criteria>

<output>
After completion, create `.planning/phases/11-ui-implementation/11-08-SUMMARY.md`
</output>
