---
phase: 11-ui-implementation
plan: 04
type: execute
wave: 3
depends_on: ["11-03"]
files_modified:
  - templates/planner.html
  - static/css/pages/planner.css
  - static/js/pages/planner.js
  - app.py
autonomous: true

must_haves:
  truths:
    - "User can view course setup form at /courses/{id}/planner"
    - "User can edit course metadata (title, description, audience, etc.)"
    - "User can manage learning outcomes with CRUD operations"
    - "User can generate blueprint from course description"
    - "User can accept or refine generated blueprint"
  artifacts:
    - path: "templates/planner.html"
      provides: "Course planning interface"
      contains: "learning-outcomes"
    - path: "static/js/pages/planner.js"
      provides: "Planner page interactivity"
      contains: "generateBlueprint"
  key_links:
    - from: "templates/planner.html"
      to: "/api/courses/{id}"
      via: "fetch API"
      pattern: "api/courses"
    - from: "templates/planner.html"
      to: "/api/courses/{id}/blueprint/generate"
      via: "fetch API"
      pattern: "api.*blueprint.*generate"
---

<objective>
Create the Planner page for course setup, learning outcome management, and AI blueprint generation.

Purpose: The Planner is where users define what their course will cover before building the structure. It combines course metadata editing, outcome definition, and AI-assisted structure generation.

Output: Planner template with three sections: Course Setup, Learning Outcomes Editor, Blueprint Generation.
</objective>

<execution_context>
@C:\Users\gpt30\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\gpt30\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/11-ui-implementation/11-CONTEXT.md
@.planning/phases/11-ui-implementation/11-03-SUMMARY.md
@src/api/learning_outcomes.py
@src/api/blueprint.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Planner Page Template</name>
  <files>
    templates/planner.html
    static/css/pages/planner.css
    app.py
  </files>
  <action>
Create the Planner page layout:

**templates/planner.html:**
Extend base.html with course context passed.

Three-section layout (tabs or accordion):

**Section 1: Course Setup**
Card with form fields:
- Title (text input, required)
- Description (textarea, 3-4 rows)
- Target Audience (dropdown: beginner, intermediate, advanced)
- Target Duration (number input, minutes)
- Modality (dropdown: self-paced, instructor-led, blended)
- Prerequisites (textarea, optional)
- Tools & Technologies (tag input or comma-separated)
- Save Changes button

**Section 2: Learning Outcomes**
Card with:
- List of existing outcomes (each shows ABCD format)
- Each outcome row: Bloom's level badge, text, Edit and Delete buttons
- Add Outcome button -> opens modal
- Outcome Modal:
  - Action (what learners will do)
  - Behavior (observable action verb)
  - Condition (under what circumstances)
  - Degree (to what standard)
  - Bloom's Level dropdown (Remember, Understand, Apply, Analyze, Evaluate, Create)
  - Save and Cancel buttons

**Section 3: Blueprint Generation**
Card with:
- Description of what blueprint generation does
- "Generate Blueprint" button (primary, large)
- Status area (shows generating progress)
- Preview area (shows generated blueprint when done)
- Accept Blueprint button (appears after generation)
- Refine button with feedback textarea (for refinement requests)

**static/css/pages/planner.css:**
- .planner-container: main layout
- .planner-section: each card section
- .section-header: section titles
- .outcome-list: list styling
- .outcome-item: individual outcome row
- .bloom-badge: colored by level
- .blueprint-preview: code/JSON preview styling
- Tab or accordion styling for section navigation

**app.py:**
Add route:
```python
@app.route('/courses/<course_id>/planner')
@login_required
def planner(course_id):
    course = project_store.load(course_id)
    if not course:
        return redirect(url_for('dashboard'))
    # Check ownership
    return render_template('planner.html',
                         course=course,
                         active_page='planner',
                         breadcrumb=[
                           {'title': 'Dashboard', 'url': '/dashboard'},
                           {'title': course.title, 'url': f'/courses/{course.id}/planner'}
                         ])
```
  </action>
  <verify>
Visit /courses/{valid-id}/planner:
- Page loads with three sections visible
- Sidebar shows course title and planner link is active
- Course metadata pre-populated from existing course
- Outcomes section shows existing outcomes (or empty message)
  </verify>
  <done>
Planner template created with three-section layout. Route added to Flask. Page loads with course context.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Course Metadata and Outcomes Editing</name>
  <files>
    static/js/pages/planner.js
    templates/planner.html
  </files>
  <action>
Add JavaScript for metadata saving and outcome CRUD:

**static/js/pages/planner.js:**

PlannerController class with courseId:

**Course Metadata:**
- initMetadataForm(): bind save button, populate form from course data
- handleMetadataSave():
  - Gather form values
  - Call api.put(`/courses/${courseId}`, data)
  - Show toast on success/error
  - Update save indicator in header

**Learning Outcomes:**
- outcomeModal: Modal instance
- currentOutcomeId: null for create, ID for edit
- loadOutcomes(): fetch from /api/courses/{id}/outcomes, render list
- showAddOutcome(): open modal with empty form
- showEditOutcome(id): fetch outcome, populate modal, open
- handleOutcomeSave():
  - Get form values (action, behavior, condition, degree, bloom_level)
  - If currentOutcomeId: PUT to /api/courses/{id}/outcomes/{oid}
  - Else: POST to /api/courses/{id}/outcomes
  - Close modal, reload outcomes list
  - Show toast
- handleOutcomeDelete(id):
  - Show confirmation modal
  - DELETE to /api/courses/{id}/outcomes/{id}
  - Reload outcomes list

**Outcome Rendering:**
- renderOutcomes(outcomes): build HTML for outcome list
- Each outcome shows full ABCD text
- Bloom's level as colored badge
- Edit and Delete buttons with onclick handlers

**Update planner.html:**
- Include planner.js
- Add data attributes for JavaScript bindings
- Outcome modal markup with form
- Initialize PlannerController on DOMContentLoaded
  </action>
  <verify>
On planner page:
- Edit title and description, save -> success toast, data persisted (refresh confirms)
- Click Add Outcome -> modal opens
- Fill ABCD form, save -> outcome appears in list
- Click Edit on outcome -> modal opens with data populated
- Save edits -> list updates
- Click Delete -> confirmation -> outcome removed
  </verify>
  <done>
Course metadata saving works. Learning outcomes CRUD operations work with modal dialogs.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add Blueprint Generation UI</name>
  <files>
    static/js/pages/planner.js
    templates/planner.html
  </files>
  <action>
Add blueprint generation and acceptance:

**Add to static/js/pages/planner.js:**

**Blueprint Generation:**
- blueprintPreview: element reference
- generateBtn: button reference
- acceptBtn: button reference
- refineBtn: button reference
- lastBlueprint: stores generated blueprint JSON

- handleGenerateBlueprint():
  - Disable generate button, show loading state
  - POST to /api/courses/{id}/blueprint/generate
  - On success:
    - Store blueprint in lastBlueprint
    - Render preview (formatted JSON or structured view)
    - Show validation messages if any
    - Show Accept and Refine buttons
  - On error: show toast error, re-enable button

- renderBlueprintPreview(blueprint):
  - Show module count, lesson count, activity count
  - List modules with lessons nested
  - Show any validation warnings/errors

- handleAcceptBlueprint():
  - POST to /api/courses/{id}/blueprint/accept
  - On success:
    - Toast "Blueprint accepted"
    - Optionally navigate to Builder page
  - On error: show error details

- handleRefineBlueprint():
  - Get feedback from textarea
  - POST to /api/courses/{id}/blueprint/refine with feedback
  - Same flow as generate (shows new preview)

**Update planner.html:**
- Blueprint section markup:
  - Generate button with onclick
  - Status/loading indicator
  - Preview container (hidden initially)
  - Accept and Refine buttons (hidden initially)
  - Feedback textarea for refinement
  </action>
  <verify>
On planner page with course description and outcomes:
- Click Generate Blueprint -> loading indicator shows
- Blueprint preview appears (shows modules/lessons/activities structure)
- Validation warnings shown if any
- Click Accept -> success toast, course structure created
- Or enter feedback, click Refine -> new blueprint generated
  </verify>
  <done>
Blueprint generation UI complete. Users can generate, preview, accept, or refine AI-generated course structure.
  </done>
</task>

</tasks>

<verification>
- Planner page loads at /courses/{id}/planner
- Sidebar shows course title and active state
- Course metadata form saves correctly
- Learning outcomes CRUD all work
- Blueprint generates and displays preview
- Blueprint can be accepted or refined
- All operations show toast feedback
- No JavaScript console errors
</verification>

<success_criteria>
1. Planner page displays with three sections
2. Course metadata edits save via API
3. Learning outcomes CRUD with modal dialogs
4. Bloom's level badges color-coded by level
5. Blueprint generation shows structured preview
6. Accept creates course structure
7. Refine allows iterative improvement
8. Sidebar shows course context correctly
</success_criteria>

<output>
After completion, create `.planning/phases/11-ui-implementation/11-04-SUMMARY.md`
</output>
