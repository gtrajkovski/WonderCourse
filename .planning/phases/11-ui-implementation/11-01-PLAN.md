---
phase: 11-ui-implementation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - static/css/variables.css
  - static/css/components.css
  - static/css/navigation.css
  - static/js/utils/api.js
  - static/js/utils/storage.js
  - static/js/utils/toast.js
  - static/js/components/modal.js
  - static/js/components/sidebar.js
  - templates/base.html
  - templates/partials/sidebar.html
  - templates/partials/header.html
autonomous: true

must_haves:
  truths:
    - "CSS variables define complete dark theme palette"
    - "Toast notifications appear and auto-dismiss"
    - "Modal dialogs trap focus and close on ESC"
    - "API wrapper handles errors consistently"
    - "Sidebar collapses to icons-only and persists state"
  artifacts:
    - path: "static/css/variables.css"
      provides: "CSS custom properties for theming"
      contains: "--bg-base: #1a1a2e"
    - path: "static/js/utils/api.js"
      provides: "Fetch wrapper with error handling"
      contains: "class APIClient"
    - path: "static/js/components/sidebar.js"
      provides: "Collapsible sidebar with localStorage"
      contains: "localStorage.getItem"
    - path: "templates/partials/sidebar.html"
      provides: "Sidebar navigation structure"
      contains: "sidebar-toggle"
  key_links:
    - from: "templates/base.html"
      to: "static/css/variables.css"
      via: "link stylesheet"
      pattern: "variables\\.css"
    - from: "templates/base.html"
      to: "templates/partials/sidebar.html"
      via: "include"
      pattern: "include.*sidebar"
---

<objective>
Create the design system foundation with CSS variables, reusable JavaScript utilities, and base template structure for Phase 11 UI implementation.

Purpose: All subsequent UI pages depend on consistent theming, API utilities, and shared components. This foundational work enables parallel development of individual pages.

Output: CSS variables file, component styles, utility JS modules, modal/sidebar components, and updated base template with sidebar structure.
</objective>

<execution_context>
@C:\Users\gpt30\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\gpt30\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-ui-implementation/11-CONTEXT.md
@.planning/phases/11-ui-implementation/11-RESEARCH.md
@templates/base.html
@static/css/main.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CSS Design System</name>
  <files>
    static/css/variables.css
    static/css/components.css
    static/css/navigation.css
  </files>
  <action>
Create CSS files implementing the locked dark theme decisions:

**static/css/variables.css:**
- Define CSS custom properties (not Sass variables)
- Backgrounds: --bg-base (#1a1a2e), --bg-panel (#16213e), --bg-input (#0f0f1a)
- Text: --text-primary (#ffffff), --text-secondary (#a0a0a0), --text-disabled (#606060)
- Accent: --accent-primary (#4361ee), --accent-hover (#3d8ee6)
- Borders: --border-subtle (#2a2a4a)
- Status: --success (#4ade80), --error (#ef4444), --warning (#fbbf24)
- Spacing: --sidebar-width (240px), --sidebar-collapsed (60px)
- Timing: --transition-fast (0.15s), --transition-normal (0.3s)

**static/css/components.css:**
- Button styles: .btn, .btn-primary, .btn-secondary, .btn-danger, .btn-ghost
- Form inputs: .form-group, .form-input, .form-label, .form-error
- Cards: .card, .card-header, .card-body
- Badges: .badge, .badge-success, .badge-warning, .badge-error
- Toast notifications: .toast-container, .toast, .toast-success, .toast-error
- Modal dialog: .modal, .modal-backdrop, .modal-content, .modal-actions
- Loading skeleton: .skeleton, .skeleton-line, @keyframes pulse

**static/css/navigation.css:**
- Sidebar styles: .sidebar (240px), .sidebar.collapsed (60px)
- Sidebar nav items with icons and text
- .nav-text hidden when collapsed
- Collapse toggle button at bottom
- Header bar: .app-header with left/center/right sections
- Breadcrumb: .breadcrumb with separators
- Save indicator and user avatar styles
  </action>
  <verify>
Open browser dev tools, confirm CSS variables are accessible via getComputedStyle(document.documentElement).getPropertyValue('--bg-base') returning #1a1a2e
  </verify>
  <done>
Three CSS files created with complete dark theme variables, component styles, and navigation styles matching locked design decisions
  </done>
</task>

<task type="auto">
  <name>Task 2: Create JavaScript Utility Modules</name>
  <files>
    static/js/utils/api.js
    static/js/utils/storage.js
    static/js/utils/toast.js
    static/js/components/modal.js
    static/js/components/sidebar.js
  </files>
  <action>
Create JavaScript utility modules following the research patterns:

**static/js/utils/api.js:**
- APIClient class with baseURL constructor parameter (default '/api')
- request(endpoint, options) method with Content-Type: application/json
- get(), post(), put(), delete() convenience methods
- Error handling: parse JSON response, throw Error with message from response.error
- Export global `api` instance

**static/js/utils/storage.js:**
- SafeStorage class with try/catch for QuotaExceededError
- set(key, value), get(key), remove(key) methods
- ScrollManager class for scroll position persistence
- Store key as `scroll_{pathname}`
- Restore on load, save on beforeunload
- Export global instances

**static/js/utils/toast.js:**
- ToastManager class
- createContainer() adds fixed position container to body
- show(message, type, duration) creates toast element
- Types: info, success, error, warning
- Auto-dismiss after duration (default 3000ms)
- CSS animation: slide in from right, fade out
- Export global `toast` instance

**static/js/components/modal.js:**
- Modal class with id constructor
- open(): set aria-hidden=false, trap focus, save lastFocusedElement
- close(): set aria-hidden=true, restore focus
- ESC key and backdrop click close modal
- trapFocus(): cycle through focusable elements
- Export Modal class for instantiation

**static/js/components/sidebar.js:**
- Sidebar class
- Load collapsed state from localStorage
- Toggle between expanded (240px) and collapsed (60px)
- Persist state to localStorage on toggle
- Hide .nav-text elements when collapsed
- Export and auto-initialize on DOMContentLoaded
  </action>
  <verify>
Open browser console, verify:
- `api.get('/courses')` returns response or error
- `toast.show('Test', 'success')` displays notification
- `new Modal('test-modal')` creates modal instance without errors
  </verify>
  <done>
Five JavaScript modules created: APIClient for fetch wrapper, SafeStorage and ScrollManager for persistence, ToastManager for notifications, Modal for dialogs, Sidebar for collapse behavior
  </done>
</task>

<task type="auto">
  <name>Task 3: Update Base Template with Sidebar Structure</name>
  <files>
    templates/base.html
    templates/partials/sidebar.html
    templates/partials/header.html
  </files>
  <action>
Update the base template and create partials:

**templates/partials/sidebar.html:**
Create sidebar partial with:
- Container div with id="sidebar" and class="sidebar"
- Course title section at top (pinned) with Jinja2 variable {{ course.title if course else 'Select a Course' }}
- Navigation links:
  - Dashboard (home icon, href="/dashboard")
  - Planner (clipboard icon, href="/courses/{{ course.id }}/planner" if course)
  - Builder (tree icon, href="/courses/{{ course.id }}/builder" if course)
  - Studio (sparkles icon, href="/courses/{{ course.id }}/studio" if course)
  - Textbook (book icon, href="/courses/{{ course.id }}/textbook" if course)
  - Publish (download icon, href="/courses/{{ course.id }}/publish" if course)
- Each nav item has icon span + nav-text span
- Collapse toggle button at bottom with id="sidebar-toggle"
- Use Unicode symbols for icons initially (can swap to icon library later)

**templates/partials/header.html:**
Create header partial with:
- Container with class="app-header"
- Left: Logo link to /dashboard
- Center: Breadcrumb nav with aria-label, uses breadcrumb variable
- Right: Save indicator (id="save-status") + user avatar (current_user.email first letter)
- User avatar as dropdown trigger (just button for now, dropdown in later plan)

**templates/base.html:**
Update to:
- Add link to variables.css, components.css, navigation.css
- Include sidebar.html partial
- Include header.html partial
- Main content area with class="main-content" that accounts for sidebar width
- Include utility scripts: api.js, storage.js, toast.js, sidebar.js
- Add body class that changes with sidebar state
- Keep existing extra_head and extra_scripts blocks

IMPORTANT: Update existing main.css to import or work alongside new CSS files (avoid conflicts with existing styles). The new CSS should extend, not replace.
  </action>
  <verify>
Run Flask app: `python app.py`
Visit http://localhost:5003/dashboard
Confirm:
- Sidebar appears on left side
- Sidebar collapses when toggle clicked
- Collapse state persists after page refresh
- Header shows logo, breadcrumb area, and user avatar
  </verify>
  <done>
Base template updated with sidebar and header partials. Sidebar collapse works with localStorage persistence. Dark theme applied consistently.
  </done>
</task>

</tasks>

<verification>
- `ls static/css/` shows variables.css, components.css, navigation.css
- `ls static/js/utils/` shows api.js, storage.js, toast.js
- `ls static/js/components/` shows modal.js, sidebar.js
- `ls templates/partials/` shows sidebar.html, header.html
- Flask app starts without errors
- Dashboard page displays with sidebar and header
- Browser dev tools show CSS variables defined on :root
</verification>

<success_criteria>
1. All CSS files created with dark theme variables matching locked decisions
2. All JavaScript utilities work in browser console
3. Base template includes sidebar and header partials
4. Sidebar collapse/expand works and persists state
5. No JavaScript console errors on page load
6. Existing dashboard functionality preserved
</success_criteria>

<output>
After completion, create `.planning/phases/11-ui-implementation/11-01-SUMMARY.md`
</output>
