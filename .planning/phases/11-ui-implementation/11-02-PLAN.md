---
phase: 11-ui-implementation
plan: 02
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - templates/auth/login.html
  - templates/auth/register.html
  - static/css/pages/auth.css
  - static/js/pages/auth.js
  - app.py
autonomous: true

must_haves:
  truths:
    - "User can view login page at /login"
    - "User can view register page at /register"
    - "Form validation displays inline errors"
    - "Successful login redirects to dashboard"
    - "Successful registration redirects to login"
  artifacts:
    - path: "templates/auth/login.html"
      provides: "Login form template"
      contains: "form"
    - path: "templates/auth/register.html"
      provides: "Registration form template"
      contains: "form"
    - path: "static/css/pages/auth.css"
      provides: "Auth page styling"
      contains: "auth-container"
  key_links:
    - from: "templates/auth/login.html"
      to: "/api/auth/login"
      via: "form action or fetch"
      pattern: "api/auth/login"
    - from: "templates/auth/register.html"
      to: "/api/auth/register"
      via: "form action or fetch"
      pattern: "api/auth/register"
---

<objective>
Create login and registration pages with form validation and error feedback using the design system foundation.

Purpose: Users need to authenticate before accessing course management features. These pages are the entry point for new and returning users.

Output: Login and registration templates with client-side validation, inline error display, and proper redirect flow.
</objective>

<execution_context>
@C:\Users\gpt30\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\gpt30\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/11-ui-implementation/11-CONTEXT.md
@.planning/phases/11-ui-implementation/11-01-SUMMARY.md
@static/css/variables.css
@static/css/components.css
@src/auth/routes.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Auth Page Templates</name>
  <files>
    templates/auth/login.html
    templates/auth/register.html
    static/css/pages/auth.css
  </files>
  <action>
Create auth page templates with centered forms:

**templates/auth/login.html:**
- Extend base.html (minimal version without sidebar for unauth pages)
- Centered card layout (max-width 400px)
- App logo/title at top
- Form fields:
  - Email input (type="email", required, autofocus)
  - Password input (type="password", required)
- Submit button with "Log In" text
- Link to register page ("Don't have an account? Sign up")
- Link to forgot password ("/forgot-password")
- Error message container (hidden by default, shows API errors)
- Each field has .form-group wrapper with .form-error for inline errors

**templates/auth/register.html:**
- Same structure as login
- Additional fields:
  - Name input (optional but encouraged)
  - Confirm password input
- Client-side validation: passwords match
- Link to login page ("Already have an account? Log in")

**static/css/pages/auth.css:**
- .auth-page: full height, centered flex container
- .auth-card: centered card with padding, max-width 400px
- .auth-logo: centered logo/title
- .auth-form: form styling
- .auth-links: links below form
- Dark theme background, card stands out slightly

IMPORTANT: Auth pages should NOT show sidebar or require login. Create a simplified base template block or conditional that hides sidebar for unauthenticated pages.
  </action>
  <verify>
Visit http://localhost:5003/login - login form displays centered
Visit http://localhost:5003/register - register form displays centered
Both pages use dark theme styling
  </verify>
  <done>
Login and register templates created with proper styling, form fields, and navigation links between pages
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Client-Side Form Validation</name>
  <files>
    static/js/pages/auth.js
    templates/auth/login.html
    templates/auth/register.html
  </files>
  <action>
Create JavaScript for form handling:

**static/js/pages/auth.js:**
- LoginForm class:
  - Attach to form submit event
  - preventDefault
  - Validate email format (basic regex)
  - Validate password not empty
  - Show inline errors for each field
  - If valid, submit via fetch to /api/auth/login
  - On success: redirect to /dashboard
  - On error: show error message from API response

- RegisterForm class:
  - Same as LoginForm plus:
  - Validate password minimum 8 characters
  - Validate passwords match (password === confirm_password)
  - Submit to /api/auth/register
  - On success: redirect to /login with success message (use query param)

- Common validation helpers:
  - showFieldError(field, message): add .has-error class, show .form-error text
  - clearFieldError(field): remove .has-error class, clear .form-error text
  - showFormError(message): show general error above submit button

**Update templates:**
- Include auth.js script in extra_scripts block
- Add data attributes for JavaScript to find elements
- Add .form-error span after each input
- Add general error container before submit button

IMPORTANT: Use the api.js utility from Plan 01 for fetch calls. Handle 401/400 errors gracefully.
  </action>
  <verify>
On login page:
- Submit empty form - inline errors appear for both fields
- Submit invalid email format - email error appears
- Submit valid form with wrong credentials - API error message displays
On register page:
- Submit with mismatched passwords - error appears
- Submit with short password - error about minimum length appears
  </verify>
  <done>
Client-side validation working for both forms with inline errors and API error display
  </done>
</task>

<task type="auto">
  <name>Task 3: Add Page Routes to Flask App</name>
  <files>
    app.py
  </files>
  <action>
Add page routes for auth templates:

**app.py additions:**
Add routes BEFORE the login_required routes:

```python
@app.route('/login')
def login_page():
    if current_user.is_authenticated:
        return redirect(url_for('dashboard'))
    return render_template('auth/login.html')

@app.route('/register')
def register_page():
    if current_user.is_authenticated:
        return redirect(url_for('dashboard'))
    return render_template('auth/register.html')
```

Also update the unauthorized handler or login_manager to redirect to /login page instead of returning JSON for page requests (keep JSON for API requests).

The auth API endpoints already exist in src/auth/routes.py - these new routes just render the templates that use those APIs.

IMPORTANT: The existing `@app.route('/')` should redirect to /login if not authenticated, or /dashboard if authenticated.
  </action>
  <verify>
- Visit http://localhost:5003/ when logged out - redirects to /login
- Visit http://localhost:5003/login when logged in - redirects to /dashboard
- Visit http://localhost:5003/register when logged in - redirects to /dashboard
- Login flow: enter credentials -> submit -> redirected to dashboard
- Register flow: enter details -> submit -> redirected to login with success indicator
  </verify>
  <done>
Auth page routes added to Flask app. Login/register pages accessible. Redirect logic works correctly.
  </done>
</task>

</tasks>

<verification>
- `ls templates/auth/` shows login.html and register.html
- `ls static/css/pages/` shows auth.css
- `ls static/js/pages/` shows auth.js
- Login page loads without errors
- Register page loads without errors
- Form validation shows inline errors
- Successful login redirects to dashboard
- Successful registration redirects to login
</verification>

<success_criteria>
1. Login and register pages render correctly with dark theme
2. Client-side validation shows inline errors for invalid input
3. API errors display in form (e.g., "Invalid credentials")
4. Successful authentication redirects appropriately
5. Unauthenticated users are redirected to login
6. Already authenticated users skip login/register pages
</success_criteria>

<output>
After completion, create `.planning/phases/11-ui-implementation/11-02-SUMMARY.md`
</output>
