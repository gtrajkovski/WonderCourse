---
phase: 12-ai-interactive-features
plan: 04
type: execute
wave: 2
depends_on: [12-01, 12-03]
files_modified:
  - src/import/converter.py
  - src/api/import_bp.py
  - tests/test_import_converter.py
autonomous: true

must_haves:
  truths:
    - "User can convert plain text into structured WWHAA video script"
    - "User can convert plain text into structured reading"
    - "AI suggests appropriate structure based on content"
    - "Conversion preserves original content while adding structure"
  artifacts:
    - path: "src/import/converter.py"
      provides: "AI-powered format conversion"
      exports: ["ContentConverter"]
  key_links:
    - from: "src/import/converter.py"
      to: "Claude API"
      via: "structured output"
      pattern: "client\\.messages\\.create"
    - from: "src/api/import_bp.py"
      to: "ContentConverter"
      via: "import and call"
      pattern: "converter\\.convert"
---

<objective>
Build AI-powered content converter that transforms plain text into structured formats.

Purpose: Enable users to paste raw content and have AI structure it into WWHAA video scripts, readings with sections, or quizzes with questions (IMPORT-06).
Output: ContentConverter that uses Claude to intelligently structure imported content.
</objective>

<execution_context>
@C:\Users\gpt30\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\gpt30\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/12-ai-interactive-features/12-RESEARCH.md

# Existing schemas for target formats
@src/generators/schemas/video_script.py
@src/generators/schemas/reading.py
@src/generators/schemas/quiz.py

# Import blueprint from Plan 12-03 (this plan adds to it)
@src/api/import_bp.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ContentConverter with structured output</name>
  <files>
    src/import/converter.py
    src/import/__init__.py
  </files>
  <action>
Create `src/import/converter.py` with ContentConverter class:

1. **Class structure:**
   - __init__(model: str = Config.MODEL)
   - convert(content: str, target_type: ContentType, context: dict = None) -> ConversionResult
   - suggest_type(content: str) -> ContentType

2. **ConversionResult dataclass:**
   - original: str (original content)
   - structured: dict (converted content matching target schema)
   - target_type: ContentType
   - confidence: float (0-1 conversion confidence)
   - changes: List[str] (what was restructured)

3. **Conversion methods for each target type:**
   - to_video_script(content: str, context: dict) -> dict
     - System prompt: "Convert this content into a WWHAA video script structure"
     - Include VideoScriptSchema fields: hook, objective, content, ivq, summary, cta
     - Context includes: topic, learning_outcomes, target_duration

   - to_reading(content: str, context: dict) -> dict
     - System prompt: "Convert this content into a structured reading"
     - Include ReadingSchema fields: introduction, sections, conclusion, references
     - Preserve key points, add APA 7 citations where sources mentioned

   - to_quiz(content: str, context: dict) -> dict
     - System prompt: "Convert this content into quiz questions"
     - Extract key concepts and generate MCQ questions
     - Include options with feedback

4. **suggest_type method:**
   - Analyze content and return most appropriate ContentType
   - Use keyword detection for quick suggestion:
     - Question marks + A/B/C/D patterns = QUIZ
     - Hook/intro/summary structure = VIDEO
     - Long paragraphs with sections = READING
   - Optionally use Claude for ambiguous cases

5. Use Claude structured outputs (tool-based approach per CLAUDE.md) for reliable JSON

Update `src/import/__init__.py` to export ContentConverter
  </action>
  <verify>
    python -c "from src.import import ContentConverter; print('Import OK')"
  </verify>
  <done>
    ContentConverter importable with convert() and suggest_type() methods
  </done>
</task>

<task type="auto">
  <name>Task 2: Add conversion endpoints to existing import blueprint</name>
  <files>
    src/api/import_bp.py
    tests/test_import_converter.py
  </files>
  <action>
1. **Update the existing `src/api/import_bp.py`** (created in Plan 12-03) to add conversion endpoints:

   POST /api/import/convert
   - Accepts: JSON with {content: str, target_type: str, context?: dict}
   - Returns: {original, structured, target_type, confidence, changes}
   - Does not save, just returns conversion result

   POST /api/courses/<course_id>/activities/<activity_id>/convert
   - Accepts: JSON with {content: str} (target_type from activity)
   - Converts content to match activity's content_type
   - Saves converted content to activity
   - Returns: {converted: true, content, changes}

   GET /api/import/suggest-type
   - Accepts: query param 'content' or POST body
   - Returns: {suggested_type, confidence, alternatives}

   Note: This updates the import_bp.py that already exists from Plan 12-03 (which created
   /api/import/analyze and /api/courses/<id>/import endpoints). Add the new conversion
   endpoints alongside the existing analyze/import endpoints.

2. Create `tests/test_import_converter.py`:
   - Test suggest_type for various content samples
   - Test to_video_script conversion
   - Test to_reading conversion
   - Test to_quiz conversion
   - Test conversion endpoint
   - Test activity-specific conversion
   - Mock Claude API for all tests
   - Verify output matches expected schemas
  </action>
  <verify>
    pytest tests/test_import_converter.py -v
  </verify>
  <done>
    Conversion endpoints work with AI-powered structuring
  </done>
</task>

</tasks>

<verification>
- ContentConverter transforms plain text into structured formats
- Video script conversion produces WWHAA structure
- Reading conversion produces sections with references
- Quiz conversion extracts questions with options
- API endpoints accessible and return correct formats
- All tests pass with mocked AI (target: 12+ tests)
</verification>

<success_criteria>
- Plain text converts to video_script with hook/objective/content/ivq/summary/cta
- Plain text converts to reading with introduction/sections/conclusion/references
- Plain text converts to quiz with questions/options/feedback
- suggest_type returns appropriate content type for various inputs
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/12-ai-interactive-features/12-04-SUMMARY.md`
</output>
