---
phase: 08-export-publishing
plan: 02
type: tdd
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/exporters/instructor_package.py
  - tests/test_instructor_package.py
autonomous: true

must_haves:
  truths:
    - "User can export instructor package as ZIP"
    - "ZIP contains syllabus, lesson plans, rubrics, quizzes, answer keys"
    - "ZIP includes textbook.docx if course has textbook chapters"
  artifacts:
    - path: "src/exporters/instructor_package.py"
      provides: "Instructor package ZIP exporter"
      exports: ["InstructorPackageExporter"]
    - path: "tests/test_instructor_package.py"
      provides: "TDD tests for instructor package"
      min_lines: 80
  key_links:
    - from: "src/exporters/instructor_package.py"
      to: "src/exporters/base_exporter.py"
      via: "BaseExporter inheritance"
      pattern: "class InstructorPackageExporter\\(BaseExporter\\)"
---

<objective>
Implement InstructorPackageExporter using TDD to create ZIP bundles containing syllabus, lesson plans, rubrics, quizzes with answer keys, and textbook.

Purpose: Requirement PUB-01 - User can export instructor package as ZIP.
Output: Working exporter with comprehensive test coverage.
</objective>

<execution_context>
@C:\Users\gpt30\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\gpt30\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-export-publishing/08-RESEARCH.md
@.planning/phases/08-export-publishing/08-01-SUMMARY.md
@src/exporters/base_exporter.py
@src/core/models.py
</context>

<feature>
  <name>InstructorPackageExporter</name>
  <files>src/exporters/instructor_package.py, tests/test_instructor_package.py</files>
  <behavior>
InstructorPackageExporter.export(course) -> (BytesIO, filename)

ZIP Archive Structure:
```
{course_title}_instructor.zip
├── syllabus.txt              # Course overview with module/lesson list
├── lesson_plans/
│   ├── {module_title}/
│   │   ├── {lesson_title}.txt  # Lesson objectives, activities, timing
├── rubrics/
│   ├── {activity_title}.txt    # Rubric criteria (for RUBRIC content types)
├── quizzes/
│   ├── {activity_title}_questions.txt  # Quiz questions only
├── answer_keys/
│   ├── {activity_title}_key.txt        # Quiz answers with explanations
├── textbook.docx             # If course has textbook_chapters (calls DOCXTextbookExporter)
```

Syllabus format:
```
Course: {title}
Duration: {target_duration_minutes} minutes
Audience: {audience_level}

Description:
{description}

Modules:
1. {module_title}
   - {lesson_title}: {activity_count} activities

Learning Outcomes:
- {behavior} (Bloom's: {bloom_level})
```

Lesson plan format:
```
Lesson: {title}
Module: {module_title}

Description: {description}

Activities:
1. {activity_title} ({content_type}, {estimated_duration_minutes} min)
   Build State: {build_state}
```

Quiz questions format (student version - no answers):
```
Quiz: {title}

1. {question_text}
   A) {option_a}
   B) {option_b}
   C) {option_c}
   D) {option_d}
```

Answer key format (instructor only):
```
Answer Key: {title}

1. {question_text}
   Correct: {correct_option_letter}
   Explanation: {feedback_for_correct}
```

Test cases:
- export_creates_valid_zip: Verify ZIP is valid and readable
- export_contains_syllabus: syllabus.txt exists with course info
- export_contains_lesson_plans: lesson_plans/{module}/{lesson}.txt for each lesson
- export_contains_rubrics: rubrics/ contains activities with ContentType.RUBRIC
- export_contains_quiz_questions: quizzes/ contains quiz questions without answers
- export_contains_answer_keys: answer_keys/ contains quiz answers
- export_handles_empty_course: Course with no modules produces valid ZIP with syllabus only
- export_sanitizes_filenames: Special characters removed from folder/file names
  </behavior>
  <implementation>
1. RED: Write failing tests first
2. GREEN: Implement InstructorPackageExporter
   - Inherit from BaseExporter
   - content_type = "application/zip"
   - file_extension = ".zip"
   - export() method:
     a. Generate syllabus text
     b. Generate lesson plans per lesson
     c. Extract rubrics from RUBRIC activities (parse JSON content)
     d. Extract quizzes from QUIZ activities (parse JSON content)
     e. Generate answer keys from quizzes
     f. If course.textbook_chapters exists, generate DOCX (can stub for now or import later)
     g. Create BytesIO, write ZipFile, seek(0), return
   - Helper methods: _generate_syllabus(), _generate_lesson_plan(), _format_rubric(), _format_quiz_questions(), _format_answer_key()
   - Use zipfile.ZipFile with ZIP_DEFLATED compression
3. REFACTOR if needed
  </implementation>
</feature>

<verification>
```bash
# TDD cycle
pytest tests/test_instructor_package.py -v

# Import check
python -c "from src.exporters import InstructorPackageExporter; print('OK')"

# Quick integration test
python -c "
from src.exporters import InstructorPackageExporter
from src.core.models import Course, Module, Lesson, Activity, ContentType
import zipfile

course = Course(title='Test Course', description='Test')
module = Module(title='Module 1')
lesson = Lesson(title='Lesson 1')
module.lessons.append(lesson)
course.modules.append(module)

exporter = InstructorPackageExporter()
buffer, filename = exporter.export(course)
with zipfile.ZipFile(buffer, 'r') as zf:
    print('Files:', zf.namelist())
print('OK')
"
```
</verification>

<success_criteria>
- InstructorPackageExporter extends BaseExporter
- export() returns valid ZIP in BytesIO
- ZIP contains syllabus.txt, lesson_plans/, rubrics/, quizzes/, answer_keys/
- 8+ TDD tests passing
- Filenames sanitized (no special chars, spaces -> underscores)
</success_criteria>

<output>
After completion, create `.planning/phases/08-export-publishing/08-02-SUMMARY.md`
</output>
