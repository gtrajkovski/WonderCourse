---
phase: 08-export-publishing
plan: 05
type: tdd
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/exporters/scorm_package.py
  - tests/test_scorm_package.py
autonomous: true

must_haves:
  truths:
    - "User can export SCORM-compliant package"
    - "Package contains valid imsmanifest.xml with SCORM 1.2 schema"
    - "Package contains HTML content pages for each module"
  artifacts:
    - path: "src/exporters/scorm_package.py"
      provides: "SCORM 1.2 package exporter"
      exports: ["SCORMPackageExporter"]
    - path: "tests/test_scorm_package.py"
      provides: "TDD tests for SCORM package"
      min_lines: 100
  key_links:
    - from: "src/exporters/scorm_package.py"
      to: "src/exporters/base_exporter.py"
      via: "BaseExporter inheritance"
      pattern: "class SCORMPackageExporter\\(BaseExporter\\)"
    - from: "src/exporters/scorm_package.py"
      to: "xml.etree.ElementTree"
      via: "XML generation"
      pattern: "import xml.etree.ElementTree as ET"
---

<objective>
Implement SCORMPackageExporter using TDD to create SCORM 1.2 compliant packages with imsmanifest.xml and HTML content.

Purpose: Requirement PUB-04 - User can export SCORM-compliant package for LMS import.
Output: Working exporter with comprehensive test coverage.
</objective>

<execution_context>
@C:\Users\gpt30\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\gpt30\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-export-publishing/08-RESEARCH.md
@.planning/phases/08-export-publishing/08-01-SUMMARY.md
@src/exporters/base_exporter.py
@src/core/models.py
</context>

<feature>
  <name>SCORMPackageExporter</name>
  <files>src/exporters/scorm_package.py, tests/test_scorm_package.py</files>
  <behavior>
SCORMPackageExporter.export(course) -> (BytesIO, filename)

SCORM 1.2 Package Structure:
```
{course_title}_scorm.zip
├── imsmanifest.xml          # SCORM 1.2 manifest
├── content/
│   ├── module_1/
│   │   ├── index.html       # Module landing page
│   │   ├── lesson_1.html    # Lesson content
│   │   ├── lesson_2.html
│   ├── module_2/
│   │   ├── index.html
│   │   ├── lesson_1.html
├── shared/
│   ├── style.css            # Basic styling
```

imsmanifest.xml Structure (SCORM 1.2):
```xml
<?xml version="1.0" encoding="UTF-8"?>
<manifest identifier="course_{id}" version="1"
    xmlns="http://www.imsproject.org/xsd/imscp_rootv1p1p2"
    xmlns:adlcp="http://www.adlnet.org/xsd/adlcp_rootv1p2"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <metadata>
    <schema>ADL SCORM</schema>
    <schemaversion>1.2</schemaversion>
  </metadata>
  <organizations default="org_default">
    <organization identifier="org_default">
      <title>{course_title}</title>
      <item identifier="item_{module_id}" identifierref="res_{module_id}">
        <title>{module_title}</title>
        <item identifier="item_{lesson_id}" identifierref="res_{lesson_id}">
          <title>{lesson_title}</title>
        </item>
      </item>
    </organization>
  </organizations>
  <resources>
    <resource identifier="res_{module_id}" type="webcontent" adlcp:scormtype="sco" href="content/module_1/index.html">
      <file href="content/module_1/index.html"/>
    </resource>
    <resource identifier="res_{lesson_id}" type="webcontent" adlcp:scormtype="sco" href="content/module_1/lesson_1.html">
      <file href="content/module_1/lesson_1.html"/>
    </resource>
  </resources>
</manifest>
```

HTML Content Page Template:
```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>{title}</title>
  <link rel="stylesheet" href="../../shared/style.css">
</head>
<body>
  <h1>{title}</h1>
  <div class="content">
    {content_html}
  </div>
  <nav>
    <a href="{prev_link}">Previous</a>
    <a href="{next_link}">Next</a>
  </nav>
</body>
</html>
```

CRITICAL SCORM 1.2 Requirements (from research):
- Use `adlcp:scormtype="sco"` (lowercase 't')
- Schema version must be exactly "1.2"
- All file paths relative to package root
- Namespaces must be exact

Test cases:
- export_creates_valid_zip: Verify ZIP is valid and readable
- export_contains_imsmanifest: imsmanifest.xml exists at root
- export_manifest_valid_xml: imsmanifest.xml is well-formed XML
- export_manifest_has_scorm_schema: schemaversion is "1.2"
- export_manifest_has_organizations: organizations element with course structure
- export_manifest_has_resources: resource elements with adlcp:scormtype="sco"
- export_contains_module_content: content/module_X/index.html exists
- export_contains_lesson_content: content/module_X/lesson_Y.html exists
- export_contains_stylesheet: shared/style.css exists
- export_handles_empty_course: Course with no modules produces valid minimal SCORM
- export_sanitizes_identifiers: Module/lesson IDs are valid XML identifiers
  </behavior>
  <implementation>
1. RED: Write failing tests first
2. GREEN: Implement SCORMPackageExporter
   - Inherit from BaseExporter
   - content_type = "application/zip"
   - file_extension = ".zip"
   - export() method:
     a. Generate imsmanifest.xml using _generate_manifest()
     b. Generate HTML content pages using _generate_html_page()
     c. Generate shared/style.css
     d. Create BytesIO, write ZipFile with all files, seek(0), return
   - _generate_manifest(course) -> str:
     a. Create manifest root with namespaces
     b. Add metadata with schema "ADL SCORM" and schemaversion "1.2"
     c. Add organizations with nested items for modules > lessons
     d. Add resources with adlcp:scormtype="sco"
     e. Format XML with minidom.toprettyxml()
   - _generate_html_page(title, content_html, prev_link, next_link) -> str
   - _generate_stylesheet() -> str (basic CSS for content pages)
   - _sanitize_identifier(id) -> str: Make ID valid for XML identifier
   - Use: xml.etree.ElementTree for XML generation
   - Use: xml.dom.minidom for pretty printing
3. REFACTOR if needed
  </implementation>
</feature>

<verification>
```bash
# TDD cycle
pytest tests/test_scorm_package.py -v

# Import check
python -c "from src.exporters import SCORMPackageExporter; print('OK')"

# Quick integration test
python -c "
from src.exporters import SCORMPackageExporter
from src.core.models import Course, Module, Lesson, Activity
import zipfile
import xml.etree.ElementTree as ET

course = Course(title='Test Course', description='Test')
module = Module(title='Module 1')
lesson = Lesson(title='Lesson 1')
activity = Activity(title='Activity 1', content='Test content')
lesson.activities.append(activity)
module.lessons.append(lesson)
course.modules.append(module)

exporter = SCORMPackageExporter()
buffer, filename = exporter.export(course)

with zipfile.ZipFile(buffer, 'r') as zf:
    print('Files:', zf.namelist())
    manifest = zf.read('imsmanifest.xml').decode('utf-8')
    # Parse to verify well-formed
    ET.fromstring(manifest)
    print('Manifest valid XML')
print('OK')
"
```
</verification>

<success_criteria>
- SCORMPackageExporter extends BaseExporter
- export() returns valid SCORM 1.2 ZIP in BytesIO
- imsmanifest.xml with correct namespaces and schema version
- HTML content pages for modules and lessons
- adlcp:scormtype="sco" (lowercase 't')
- 11+ TDD tests passing
</success_criteria>

<output>
After completion, create `.planning/phases/08-export-publishing/08-05-SUMMARY.md`
</output>
