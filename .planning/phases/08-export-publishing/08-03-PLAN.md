---
phase: 08-export-publishing
plan: 03
type: tdd
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/exporters/lms_manifest.py
  - tests/test_lms_manifest.py
autonomous: true

must_haves:
  truths:
    - "User can export LMS manifest as structured JSON"
    - "JSON contains complete course hierarchy (modules, lessons, activities)"
    - "JSON includes learning outcomes with activity mappings"
  artifacts:
    - path: "src/exporters/lms_manifest.py"
      provides: "LMS JSON manifest exporter"
      exports: ["LMSManifestExporter"]
    - path: "tests/test_lms_manifest.py"
      provides: "TDD tests for LMS manifest"
      min_lines: 60
  key_links:
    - from: "src/exporters/lms_manifest.py"
      to: "src/exporters/base_exporter.py"
      via: "BaseExporter inheritance"
      pattern: "class LMSManifestExporter\\(BaseExporter\\)"
---

<objective>
Implement LMSManifestExporter using TDD to create structured JSON manifests with complete course hierarchy.

Purpose: Requirement PUB-02 - User can export LMS manifest as structured JSON.
Output: Working exporter with comprehensive test coverage.
</objective>

<execution_context>
@C:\Users\gpt30\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\gpt30\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-export-publishing/08-RESEARCH.md
@.planning/phases/08-export-publishing/08-01-SUMMARY.md
@src/exporters/base_exporter.py
@src/core/models.py
</context>

<feature>
  <name>LMSManifestExporter</name>
  <files>src/exporters/lms_manifest.py, tests/test_lms_manifest.py</files>
  <behavior>
LMSManifestExporter.export(course) -> (BytesIO, filename)

JSON Structure:
```json
{
  "version": "1.0",
  "exported_at": "2026-02-06T12:00:00Z",
  "course": {
    "id": "course_abc123",
    "title": "Course Title",
    "description": "Course description",
    "audience_level": "intermediate",
    "duration_minutes": 60,
    "prerequisites": "Optional prerequisites text",
    "tools": ["Tool 1", "Tool 2"],
    "grading_policy": "Optional grading policy",
    "learning_outcomes": [
      {
        "id": "lo_abc123",
        "behavior": "Student will be able to...",
        "bloom_level": "apply",
        "mapped_activities": ["act_123", "act_456"]
      }
    ],
    "modules": [
      {
        "id": "mod_abc123",
        "title": "Module Title",
        "description": "Module description",
        "order": 0,
        "lessons": [
          {
            "id": "les_abc123",
            "title": "Lesson Title",
            "description": "Lesson description",
            "order": 0,
            "activities": [
              {
                "id": "act_abc123",
                "title": "Activity Title",
                "content_type": "video",
                "activity_type": "video_lecture",
                "duration_minutes": 10,
                "bloom_level": "apply",
                "build_state": "generated",
                "order": 0
              }
            ]
          }
        ]
      }
    ]
  }
}
```

Test cases:
- export_returns_valid_json: Verify JSON is parseable
- export_contains_course_metadata: id, title, description, audience_level, duration_minutes
- export_contains_learning_outcomes: All outcomes with bloom_level and mapped_activities
- export_contains_modules_hierarchy: Modules -> Lessons -> Activities structure
- export_activity_fields_correct: Each activity has required fields
- export_handles_empty_course: Course with no modules produces valid JSON
- export_handles_none_values: Optional fields (prerequisites, grading_policy) handled gracefully
  </behavior>
  <implementation>
1. RED: Write failing tests first
2. GREEN: Implement LMSManifestExporter
   - Inherit from BaseExporter
   - content_type = "application/json"
   - file_extension = ".json"
   - export() method:
     a. Build manifest dict using generate_manifest(course)
     b. Serialize to JSON with indent=2
     c. Encode to bytes, wrap in BytesIO, seek(0)
     d. Return (buffer, filename)
   - generate_manifest(course) -> Dict[str, Any]:
     a. Add version "1.0"
     b. Add exported_at timestamp (datetime.now().isoformat())
     c. Add course object with all nested structures
     d. Handle None values gracefully (exclude or include as null)
   - Use json.dumps with ensure_ascii=False for UTF-8 support
3. REFACTOR if needed
  </implementation>
</feature>

<verification>
```bash
# TDD cycle
pytest tests/test_lms_manifest.py -v

# Import check
python -c "from src.exporters import LMSManifestExporter; print('OK')"

# Quick integration test
python -c "
from src.exporters import LMSManifestExporter
from src.core.models import Course, Module, Lesson, Activity
import json

course = Course(title='Test Course', description='Test')
module = Module(title='Module 1')
lesson = Lesson(title='Lesson 1')
activity = Activity(title='Activity 1')
lesson.activities.append(activity)
module.lessons.append(lesson)
course.modules.append(module)

exporter = LMSManifestExporter()
buffer, filename = exporter.export(course)
data = json.loads(buffer.read().decode('utf-8'))
print('Course title:', data['course']['title'])
print('OK')
"
```
</verification>

<success_criteria>
- LMSManifestExporter extends BaseExporter
- export() returns valid JSON in BytesIO
- JSON contains complete course hierarchy
- JSON includes learning outcomes with mappings
- 7+ TDD tests passing
- UTF-8 encoding supported
</success_criteria>

<output>
After completion, create `.planning/phases/08-export-publishing/08-03-SUMMARY.md`
</output>
